#!/bin/bash 

if [ -z "$1" ]; then
	echo "Usage: ./prepare_all <project_folder> [language_ID]"
	exit 
fi

echo "cd $1"
cd $1
PROJECT_FOLDER=$(pwd)

. $PROJECT_FOLDER/scripts/conll2009/globals "$PROJECT_FOLDER"
. $SCRIPT_FOLDER_2009/utils

TMP_EXT=.TMP

PD_PARAM=5 

FROM_ID=0;
TO_ID=${#TRAIN_FILES[@]}

if [ -n "$2" ]; then
	FROM_ID=$2
	TO_ID=$2
	let FROM_ID=FROM_ID-1
fi

COUNTER=$FROM_ID
while [ $COUNTER -lt  $TO_ID ]; do
		echo
		echo "converting to titov format from: ${TRAIN_FILES[$COUNTER]} , to: ${TRAIN_FILES[$COUNTER]}$TF_EXT"
		echo "$SCRIPT_FOLDER_2009/conll09_to_titovf $PROJECT_FOLDER ${TRAIN_FILES[$COUNTER]} ${TRAIN_FILES[$COUNTER]}$TF_EXT "
 		$SCRIPT_FOLDER_2009/conll09_to_titovf $PROJECT_FOLDER ${TRAIN_FILES[$COUNTER]} ${TRAIN_FILES[$COUNTER]}$TF_EXT 


		echo 
		echo "converting to titov format from: ${DEV_FILES[$COUNTER]} , to: ${DEV_FILES[$COUNTER]}$TF_EXT"
		echo "$SCRIPT_FOLDER_2009/conll09_to_titovf $PROJECT_FOLDER ${DEV_FILES[$COUNTER]} ${DEV_FILES[$COUNTER]}$TF_EXT "
 		$SCRIPT_FOLDER_2009/conll09_to_titovf $PROJECT_FOLDER ${DEV_FILES[$COUNTER]} ${DEV_FILES[$COUNTER]}$TF_EXT 


                if [ -n ${TEST_FILES[$COUNTER]} ]
                then

			echo 
			echo "padding test file"
			echo "mv ${TEST_FILES[$COUNTER]} ${TEST_FILES[$COUNTER]}$TMP_EXT"
			mv ${TEST_FILES[$COUNTER]} ${TEST_FILES[$COUNTER]}$TMP_EXT
			echo "$SCRIPT_FOLDER_2009/fillTestColumns.pl ${TEST_FILES[$COUNTER]}$TMP_EXT ${SYS_PAD_LBL[$COUNTER]}> ${TEST_FILES[$COUNTER]}"
			$SCRIPT_FOLDER_2009/fillTestColumns.pl ${TEST_FILES[$COUNTER]}$TMP_EXT ${SYN_PAD_LBL[$COUNTER]}> ${TEST_FILES[$COUNTER]}
			echo "rm ${TEST_FILES[$COUNTER]}$TMP_EXT"
			rm ${TEST_FILES[$COUNTER]}$TMP_EXT

			echo 
			echo "converting to titov format from: ${TEST_FILES[$COUNTER]} , to: ${TEST_FILES[$COUNTER]}$TF_EXT"
			echo "$SCRIPT_FOLDER_2009/conll09_to_titovf $PROJECT_FOLDER ${TEST_FILES[$COUNTER]} ${TEST_FILES[$COUNTER]}$TF_EXT "
 			$SCRIPT_FOLDER_2009/conll09_to_titovf $PROJECT_FOLDER ${TEST_FILES[$COUNTER]} ${TEST_FILES[$COUNTER]}$TF_EXT 

			echo
			echo "$SCRIPT_FOLDER/prepare_data_2009 ${SYN_ROOT_LBL[$COUNTER]} $PD_PARAM $PD_PARAM ${LANGUAGE_FOLDERS[$COUNTER]} ${TRAIN_FILES[$COUNTER]}$TF_EXT ${DEV_FILES[$COUNTER]}$TF_EXT ${TEST_FILES[$COUNTER]}$TF_EXT"
			$SCRIPT_FOLDER/prepare_data_2009 ${SYN_ROOT_LBL[$COUNTER]} $PD_PARAM $PD_PARAM ${LANGUAGE_FOLDERS[$COUNTER]} ${TRAIN_FILES[$COUNTER]}$TF_EXT ${DEV_FILES[$COUNTER]}$TF_EXT ${TEST_FILES[$COUNTER]}$TF_EXT

			echo 
			echo "$SCRIPT_FOLDER_2009/addFillPredColumn ${TRAIN_FILES[$COUNTER]}$TEX_EXT ${DEV_FILES[$COUNTER]}$TEX_EXT ${TEST_FILES[$COUNTER]}$TEX_EXT"
			$SCRIPT_FOLDER_2009/addFillPredColumn ${TRAIN_FILES[$COUNTER]}$TEX_EXT ${DEV_FILES[$COUNTER]}$TEX_EXT ${TEST_FILES[$COUNTER]}$TEX_EXT


		else
			echo
			echo "$SCRIPT_FOLDER/prepare_data_2009 ${SYN_ROOT_LBL[$COUNTER]} $PD_PARAM $PD_PARAM ${LANGUAGE_FOLDERS[$COUNTER]} ${TRAIN_FILES[$COUNTER]}$TF_EXT ${DEV_FILES[$COUNTER]}$TF_EXT"
			$SCRIPT_FOLDER/prepare_data_2009 ${SYN_ROOT_LBL[$COUNTER]} $PD_PARAM $PD_PARAM ${LANGUAGE_FOLDERS[$COUNTER]} ${TRAIN_FILES[$COUNTER]}$TF_EXT ${DEV_FILES[$COUNTER]}$TF_EXT 

			echo 
			echo "$SCRIPT_FOLDER_2009/addFillPredColumn ${TRAIN_FILES[$COUNTER]}$TEX_EXT ${DEV_FILES[$COUNTER]}$TEX_EXT"
			$SCRIPT_FOLDER_2009/addFillPredColumn ${TRAIN_FILES[$COUNTER]}$TEX_EXT ${DEV_FILES[$COUNTER]}$TEX_EXT 


		fi

        let COUNTER=COUNTER+1 
done
